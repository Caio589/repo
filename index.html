<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PDV Barbearia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#111;
  color:#fff;
}
.menu{
  display:flex;
  gap:10px;
  padding:10px;
  background:#000;
}
.menu button{
  background:#222;
  border:none;
  color:#fff;
  padding:10px;
  cursor:pointer;
}
.section{display:none;padding:15px}
.section.active{display:block}
input,select,button{
  padding:8px;
  margin:4px 0;
}
table{width:100%;border-collapse:collapse}
td,th{border-bottom:1px solid #333;padding:6px}
.total{font-size:20px;color:#2ecc71}
</style>
</head>

<body>

<div class="menu">
  <button onclick="show('pdv')">PDV</button>
  <button onclick="show('clientes')">Clientes</button>
  <button onclick="show('planos')">Planos</button>
  <button onclick="show('produtos')">Produtos</button>
  <button onclick="show('despesas')">Despesas</button>
  <button onclick="show('financeiro')">Financeiro</button>
</div>

<!-- PDV -->
<div id="pdv" class="section active">
  <h2>PDV</h2>
  <p id="statusCaixa"></p>

  <select id="cliente"></select>
  <select id="produto"></select>
  <button onclick="addItem()">Adicionar</button>

  <table id="carrinho"></table>
  <p class="total">Total: R$ <span id="total">0.00</span></p>

  <button onclick="finalizarVenda()">Finalizar Venda</button>
  <button onclick="abrirCaixa()">Abrir Caixa</button>
  <button onclick="fecharCaixa()">Fechar Caixa</button>
</div>

<!-- CLIENTES -->
<div id="clientes" class="section">
  <h2>Clientes</h2>
  <input id="nomeCliente" placeholder="Nome">
  <select id="planoCliente"></select>
  <button onclick="salvarCliente()">Salvar</button>
  <ul id="listaClientes"></ul>
</div>

<!-- PLANOS -->
<div id="planos" class="section">
  <h2>Planos</h2>
  <input id="nomePlano" placeholder="Nome">
  <input id="qtdPlano" type="number" placeholder="Qtd procedimentos">
  <input id="tipoPlano" placeholder="Tipo serviço (ex: corte)">
  <button onclick="salvarPlano()">Salvar</button>
  <ul id="listaPlanos"></ul>
</div>

<!-- PRODUTOS -->
<div id="produtos" class="section">
  <h2>Produtos / Serviços</h2>
  <input id="nomeProd" placeholder="Nome">
  <input id="valorProd" type="number" placeholder="Valor">
  <select id="tipoProd">
    <option value="produto">Produto</option>
    <option value="servico">Serviço</option>
  </select>
  <button onclick="salvarProduto()">Salvar</button>
  <ul id="listaProdutos"></ul>
</div>

<!-- DESPESAS -->
<div id="despesas" class="section">
  <h2>Despesas</h2>
  <input id="descDespesa" placeholder="Descrição">
  <input id="valorDespesa" type="number" placeholder="Valor">
  <button onclick="salvarDespesa()">Salvar</button>
  <ul id="listaDespesas"></ul>
</div>

<!-- FINANCEIRO -->
<div id="financeiro" class="section">
  <h2>Financeiro</h2>
  <p>Faturamento: R$ <span id="fat"></span></p>
  <p>Despesas: R$ <span id="desp"></span></p>
  <p class="total">Lucro: R$ <span id="lucro"></span></p>
</div>

<script>
const db = JSON.parse(localStorage.getItem("db")) || {
  clientes:[],
  planos:[],
  produtos:[],
  vendas:[],
  despesas:[],
  caixa:{aberto:false}
};

let carrinho=[];

function save(){ localStorage.setItem("db",JSON.stringify(db)); }

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  render();
}

function render(){
  statusCaixa.innerText = db.caixa.aberto ? "Caixa aberto" : "Caixa fechado";

  cliente.innerHTML = db.clientes.map(c=>`<option>${c.nome}</option>`).join("");
  produto.innerHTML = db.produtos.map(p=>`<option>${p.nome}|${p.valor}|${p.tipo}</option>`).join("");
  planoCliente.innerHTML = `<option value="">Sem plano</option>` + db.planos.map(p=>`<option>${p.nome}</option>`).join("");

  listaClientes.innerHTML = db.clientes.map(c=>`<li>${c.nome} | Saldo: ${c.saldo||0}</li>`).join("");
  listaPlanos.innerHTML = db.planos.map(p=>`<li>${p.nome} (${p.qtd} ${p.tipo})</li>`).join("");
  listaProdutos.innerHTML = db.produtos.map(p=>`<li>${p.nome} (${p.tipo})</li>`).join("");
  listaDespesas.innerHTML = db.despesas.map(d=>`<li>${d.desc} - R$ ${d.valor}</li>`).join("");

  carrinhoRender();
  financeiroRender();
}

function carrinhoRender(){
  let h="<tr><th>Item</th><th>Valor</th></tr>";
  let t=0;
  carrinho.forEach(i=>{ h+=`<tr><td>${i.nome}</td><td>${i.valor}</td></tr>`; t+=i.valor; });
  carrinho.innerHTML=h;
  total.innerText=t.toFixed(2);
}

function abrirCaixa(){ db.caixa.aberto=true; save(); render(); }
function fecharCaixa(){ db.caixa.aberto=false; save(); render(); }

function addItem(){
  if(!db.caixa.aberto) return alert("Abra o caixa");
  const [nome,valor,tipo]=produto.value.split("|");
  const cli=db.clientes.find(c=>c.nome===cliente.value);

  if(cli && cli.plano && tipo==="servico" && cli.saldo>0){
    cli.saldo--; save(); render();
    alert("Plano usado. Saldo: "+cli.saldo);
    return;
  }
  carrinho.push({nome,valor:Number(valor)});
  carrinhoRender();
}

function finalizarVenda(){
  const totalVenda=carrinho.reduce((s,i)=>s+i.valor,0);
  db.vendas.push({total:totalVenda,data:new Date().toISOString()});
  carrinho=[]; save(); render();
}

function salvarCliente(){
  const p=db.planos.find(p=>p.nome===planoCliente.value);
  db.clientes.push({nome:nomeCliente.value,plano:p?p.nome:null,saldo:p?p.qtd:0});
  save(); render();
}

function salvarPlano(){ db.planos.push({nome:nomePlano.value,qtd:+qtdPlano.value,tipo:tipoPlano.value}); save(); render(); }
function salvarProduto(){ db.produtos.push({nome:nomeProd.value,valor:+valorProd.value,tipo:tipoProd.value}); save(); render(); }
function salvarDespesa(){ db.despesas.push({desc:descDespesa.value,valor:+valorDespesa.value}); save(); render(); }

function financeiroRender(){
  const fat=db.vendas.reduce((s,v)=>s+v.total,0);
  const desp=db.despesas.reduce((s,d)=>s+d.valor,0);
  fat.innerText=fat.toFixed(2);
  desp.innerText=desp.toFixed(2);
  lucro.innerText=(fat-desp).toFixed(2);
}

render();
</script>

</body>
</html>
